<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><title>Standalone SQL Log Analyser by Sony Mathew | Thu Nov 12 2020 | The Usual Ramblings</title><meta name="title" content="Standalone SQL Log Analyser by Sony Mathew | Thu Nov 12 2020 | The Usual Ramblings"/><meta name="description" content="A standalone web app that parses the SQL queries from the log and categorises them by tables and query types."/><meta property="og:title" content="Standalone SQL Log Analyser"/><meta property="og:description" content="A standalone web app that parses the SQL queries from the log and categorises them by tables and query types."/><meta property="og:image" content="https://sony-mathew.com/images/sony.jpeg"/><meta property="og:url" content="https://sony-mathew.com/blog/sql-log-analyzer"/><meta property="og:site_name" content="The Usual Ramblings"/><meta property="og:type" content="article"/><meta property="article:published_time" content="Thu Nov 12 2020"/><meta property="article:author" content="Sony Mathew"/><meta property="article:tag" content="sql,analyzer,performance,log,parser"/><meta name="twitter:card" content="summary"/><meta name="twitter:title" content="Standalone SQL Log Analyser"/><meta name="twitter:description" content="A standalone web app that parses the SQL queries from the log and categorises them by tables and query types."/><meta name="twitter:creator" content="@sonymathew_"/><meta name="twitter:image" content="https://sony-mathew.com/images/sony.jpeg"/><meta name="twitter:image:alt" content="Standalone SQL Log Analyser"/><meta name="twitter:label1" value="Reading time"/><meta name="twitter:data1" value="7 min read"/><meta name="robots" content="index,follow,max-image-preview:large"/><meta name="next-head-count" content="23"/><link rel="icon" href="/favicon.ico"/><link href="/styles/custom.css" rel="stylesheet"/><link rel="alternate" type="application/rss+xml" title="RSS feed for The Usual Ramblings" href="https://sony-mathew.com/rss.xml"/><script async="" src="https://www.googletagmanager.com/gtag/js?id=G-C709049M5H"></script><script>window.dataLayer = window.dataLayer || [];
                function gtag(){dataLayer.push(arguments);}
                gtag('js', new Date());
                gtag('config', 'G-C709049M5H');</script><script async="" src="https://static.addtoany.com/menu/page.js"></script><link rel="preload" href="/_next/static/css/1024d1890e6094a3.css" as="style"/><link rel="stylesheet" href="/_next/static/css/1024d1890e6094a3.css" data-n-g=""/><link rel="preload" href="/_next/static/css/18522fad25fdb2bc.css" as="style"/><link rel="stylesheet" href="/_next/static/css/18522fad25fdb2bc.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-42372ed130431b0a.js"></script><script src="/_next/static/chunks/webpack-ee7e63bc15b31913.js" defer=""></script><script src="/_next/static/chunks/framework-49c6cecf1f6d5795.js" defer=""></script><script src="/_next/static/chunks/main-b72093f7aa2e45f9.js" defer=""></script><script src="/_next/static/chunks/pages/_app-36df1145104c1b7e.js" defer=""></script><script src="/_next/static/chunks/996-80bd74c565659df8.js" defer=""></script><script src="/_next/static/chunks/367-e559be0fc45df383.js" defer=""></script><script src="/_next/static/chunks/529-e8f2f72d1a7a2b3c.js" defer=""></script><script src="/_next/static/chunks/165-1551fd14e349c80a.js" defer=""></script><script src="/_next/static/chunks/pages/blog/%5Bid%5D-0cbea965b1c32ef0.js" defer=""></script><script src="/_next/static/weyHfHao6ypz-gaYJ5Xsm/_buildManifest.js" defer=""></script><script src="/_next/static/weyHfHao6ypz-gaYJ5Xsm/_ssgManifest.js" defer=""></script><style id="__jsx-88755b2c78525ae5">pre{position:relative}.copy-button{position:absolute;top:8px;right:8px;z-index:10;background-color:rgba(255,255,255,.1);border:1px solid rgba(255,255,255,.2);-webkit-border-radius:4px;-moz-border-radius:4px;border-radius:4px;color:#fff;font-size:12px;padding:4px 8px;cursor:pointer;-webkit-transition:all.2s ease;-moz-transition:all.2s ease;-o-transition:all.2s ease;transition:all.2s ease}.copy-button:hover{background-color:rgba(255,255,255,.2)}</style></head><body class="antialiased"><div id="__next"><header class="layout_container__RYcjt"><div class="hidden lg:block"><div class="flex flex-row mb-10"><div class="flex-none text-gray-700 pl-0"><a class="text-lg text-gray-600 hover:no-underline" href="/">The Usual Ramblings</a></div><div class="flex flex-grow justify-center space-x-4"></div><div class="flex flex-row space-x-4 mt-2"><a class="nav-item text-lg text-gray-600 hover:no-underline px-2 pb-1" href="/blog">Blog</a><a class="nav-item text-lg text-gray-600 hover:no-underline px-2 pb-1" href="/projects">Projects</a></div></div></div><div class="block lg:hidden"><ul class="inline-flex m-0"><li><button class="py-2 text-gray-600 appearance-none focus:outline-none"><svg class="fill-current h-3 w-3" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><title>Menu</title><path d="M0 3h20v2H0V3zm0 6h20v2H0V9zm0 6h20v2H0v-2z"></path></svg></button></li><li class="mx-4"><a class="text-lg text-gray-600 hover:no-underline py-1" href="/">The Usual Ramblings</a></li></ul></div></header><main class="layout_container__RYcjt"><article><h1 class="utils_headingXl__H5ueI">Standalone SQL Log Analyser</h1><div class="utils_lightText__4lyO2"><div>Sony Mathew</div><time dateTime="2020-11-12">November 12, 2020</time> • <!-- -->7<!-- --> min read</div><br/><br/><div class="utils_tocHeader__Lk5UC">Table of Contents</div><div class="utils_toc__EWigZ"><li style="margin-left: 20px">
      <a href="#motivation" style="line-height:1.5;">
        <span class="section-number">1.</span> Motivation
      </a>
    </li>
<li style="margin-left: 20px">
      <a href="#development" style="line-height:1.5;">
        <span class="section-number">2.</span> Development
      </a>
    </li>
<li style="margin-left: 20px">
      <a href="#working" style="line-height:1.5;">
        <span class="section-number">3.</span> Working
      </a>
    </li>
<li style="margin-left: 20px">
      <a href="#optimizing-queries" style="line-height:1.5;">
        <span class="section-number">4.</span> Optimizing Queries
      </a>
    </li>
<li style="margin-left: 20px">
      <a href="#special-mention" style="line-height:1.5;">
        <span class="section-number">5.</span> Special Mention
      </a>
    </li>
<li style="margin-left: 20px">
      <a href="#links" style="line-height:1.5;">
        <span class="section-number">6.</span> Links
      </a>
    </li></div><div class="mt-5"><p>This is a standalone web app that parses the SQL queries from the log and categorises them by tables and query types.</p>
<h1 id="motivation">Motivation</h1>
<p>While I was working in Freshworks, during feature development, I was expected to optimize each and every query that was fired as part of the feature. And many times the existing queries had to be optimized to have better response times.</p>
<p>In local development, it was very tiresome to look through the Rails server logs to find out the join queries, unexpected table's queries and unwanted load queries. In order to get a holistic and organised view of the queries from the Rails server logs, I wrote this tiny standalone app using angular.</p>
<h1 id="development">Development</h1>
<p>Learning Angular was one of the objectives of this hobby project. I experimented with angular for the first time while developing this (2014). I used the most primitive version of Angular for this. At that point in time, my style of learning things was to just get into it and do it. If you don't know something, search for it, learn it and do it.</p>
<p>The first plan of action for this to work was to find the SQL queries from the log. The second step was to parse the queries and categorise them by tables and query types. Fortunately enough, I found a javascript library called <code>simpleSqlParser</code> which does this. With that library and a UI powered by Angular, I created a V1 version of this.</p>
<p>Recently when I was going through this, I decided to use tailwind for CSS. The first version had a bunch of handwritten CSS styles and HTML packed with some Angular controllers. If you go through the older commits from 2014-15, you will see this.</p>
<h1 id="working">Working</h1>
<p>This web app does not require a backend and can run in any browser. This app is used to categorise the queries by tables and by type from the log. (If you are running a Rails server, you can directly copy-paste the server logs as it will have the SQL queries.)</p>
<p>To get this working, follow the following steps:</p>
<ol>
<li>You have two options to get hands-on with this.
<ol>
<li>You can visit the <a href="https://sony-mathew.com/sql-log-analyzer/" target="_blank" rel="nofollow">live demo page</a></li>
<li>Or set this up in local environment by
<ol>
<li>Cloning the repo using the following command : <code>git clone git@github.com:sony-mathew/sql-log-analyzer.git</code></li>
<li>and going to the cloned repo directory and open the <code>index.html</code> file in your browser.</li>
</ol>
</li>
</ol>
</li>
<li>The first page will have a plain text box to input the log. Copy and paste the server log in the text box. Click on Submit button.
<img src="/images/posts/sql-log-analyzer/input.png" /></li>
<li>Voila. Now you will be shown a page where you can select the table. Now select a table from the dropdown.</li>
<li>After selecting the table you can select the type of query related to that table.
<img src="/images/posts/sql-log-analyzer/table_select.png" /></li>
<li>As soon as you select the query type, all the queries of that type related to that table you selected will be listed below.</li>
</ol>
<h1 id="optimizing-queries">Optimizing Queries</h1>
<p>With this, you have the list of tables and types of queries (<code>JOINS</code>, <code>GROUP BY</code>, <code>WHERE</code> conditions). Now the question is how do you take action on this.</p>
<p>I primarily worked with MySQL and Postgres. What I did with the above info was to find some suspicious queries (which had <code>JOINS</code>, <code>WHERE</code>, <code>ORDER BY</code> or <code>GROUP BY</code>). Once I isolated the queries which I think was non-performant, I used <code>EXPLAIN</code> on those queries. The <code>EXPLAIN</code> statement is used to obtain a query execution plan (that is, an explanation of how MySQL or Postgres would execute a query).</p>
<p>For example, consider the following query.</p>
<pre class="language-sql"><code class="language-sql code-highlight"><span class="code-line line-number" line="1"><span class="token keyword">SELECT</span> <span class="token string">"titles"</span><span class="token punctuation">.</span><span class="token string">"tconst"</span><span class="token punctuation">,</span> <span class="token string">"originalTitle"</span><span class="token punctuation">,</span> <span class="token string">"crew"</span><span class="token punctuation">.</span><span class="token string">"directors"</span> <span class="token keyword">FROM</span> <span class="token string">"titles"</span> <span class="token keyword">INNER</span> <span class="token keyword">JOIN</span> <span class="token string">"crew"</span> <span class="token keyword">ON</span> <span class="token string">"titles"</span><span class="token punctuation">.</span><span class="token string">"tconst"</span><span class="token operator">=</span><span class="token string">"crew"</span><span class="token punctuation">.</span><span class="token string">"tconst"</span><span class="token punctuation">;</span>
</span></code></pre>
<p>This is the output for this query in the console.</p>
<img src="/images/posts/sql-log-analyzer/sql-select-query.png" />
<p>When you do <code>EXPLAIN</code> on this query</p>
<pre class="language-sql"><code class="language-sql code-highlight"><span class="code-line line-number" line="1"><span class="token keyword">EXPLAIN</span> <span class="token keyword">SELECT</span> <span class="token string">"titles"</span><span class="token punctuation">.</span><span class="token string">"tconst"</span><span class="token punctuation">,</span> <span class="token string">"originalTitle"</span><span class="token punctuation">,</span> <span class="token string">"crew"</span><span class="token punctuation">.</span><span class="token string">"directors"</span> <span class="token keyword">FROM</span> <span class="token string">"titles"</span> <span class="token keyword">INNER</span> <span class="token keyword">JOIN</span> <span class="token string">"crew"</span> <span class="token keyword">ON</span> <span class="token string">"titles"</span><span class="token punctuation">.</span><span class="token string">"tconst"</span><span class="token operator">=</span><span class="token string">"crew"</span><span class="token punctuation">.</span><span class="token string">"tconst"</span><span class="token punctuation">;</span>
</span></code></pre>
<p>you will get the following output</p>
<pre class="language-sql"><code class="language-sql code-highlight"><span class="code-line line-number" line="1"><span class="token keyword">Hash</span> <span class="token keyword">Join</span>  <span class="token punctuation">(</span>cost<span class="token operator">=</span><span class="token number">269460.21</span><span class="token punctuation">.</span><span class="token number">.750552</span><span class="token number">.93</span> <span class="token keyword">rows</span><span class="token operator">=</span><span class="token number">7328951</span> width<span class="token operator">=</span><span class="token number">38</span><span class="token punctuation">)</span>
</span><span class="code-line line-number" line="2">  <span class="token keyword">Hash</span> Cond: <span class="token punctuation">(</span>titles<span class="token punctuation">.</span>tconst <span class="token operator">=</span> crew<span class="token punctuation">.</span>tconst<span class="token punctuation">)</span>
</span><span class="code-line line-number" line="3">  <span class="token operator">-</span><span class="token operator">></span>  Seq Scan <span class="token keyword">on</span> titles  <span class="token punctuation">(</span>cost<span class="token operator">=</span><span class="token number">0.00</span><span class="token punctuation">.</span><span class="token number">.182196</span><span class="token number">.51</span> <span class="token keyword">rows</span><span class="token operator">=</span><span class="token number">7328951</span> width<span class="token operator">=</span><span class="token number">30</span><span class="token punctuation">)</span>
</span><span class="code-line line-number" line="4">  <span class="token operator">-</span><span class="token operator">></span>  <span class="token keyword">Hash</span>  <span class="token punctuation">(</span>cost<span class="token operator">=</span><span class="token number">134872.76</span><span class="token punctuation">.</span><span class="token number">.134872</span><span class="token number">.76</span> <span class="token keyword">rows</span><span class="token operator">=</span><span class="token number">7330676</span> width<span class="token operator">=</span><span class="token number">18</span><span class="token punctuation">)</span>
</span><span class="code-line line-number" line="5">        <span class="token operator">-</span><span class="token operator">></span>  Seq Scan <span class="token keyword">on</span> crew  <span class="token punctuation">(</span>cost<span class="token operator">=</span><span class="token number">0.00</span><span class="token punctuation">.</span><span class="token number">.134872</span><span class="token number">.76</span> <span class="token keyword">rows</span><span class="token operator">=</span><span class="token number">7330676</span> width<span class="token operator">=</span><span class="token number">18</span><span class="token punctuation">)</span>
</span></code></pre>
<img src="/images/posts/sql-log-analyzer/sql-explain-query.png" />
<p>With this query plan, you can identify sequential scans performed. If there is an <code>ORDER BY</code> clause, you might see <code>Using temporary; Using filesort;</code> in the query plan. This will give an idea on which parts of the query is making it slow. Now it's up to you to take action on the slow parts of the query.</p>
<p>To fine-tune a query you have to go deeper and understand how each of the parts works. If you know how MySQL executes <code>ORDER BY</code>, you will do certain things to optimize that when you have an <code>ORDER BY</code> in your SQL query. This is not an everyday scenario in smaller companies. This becomes relevant when you are at scale and avoiding the bottlenecks, optimizing the system and resources for maximum performance and output.</p>
<p>Bonus reading on <a href="http://s.petrunia.net/blog/?p=24" target="_blank" rel="nofollow">How MySQL executes ORDER BY</a>.</p>
<h1 id="special-mention">Special Mention</h1>
<p>I have used a third party javascript library for parsing the SQL Queries.
This libary is called <a href="https://github.com/dsferruzza/simpleSqlParser" target="_blank" rel="nofollow">simpleSqlParser</a> and it's an awesome library, without which it would have been very difficult.</p>
<h1 id="links">Links</h1>
<p><a href="https://sony-mathew.com/sql-log-analyzer/" target="_blank" rel="nofollow">Live Demo</a></p>
<p><a href="https://github.com/sony-mathew/sql-log-analyzer/" target="_blank" rel="nofollow">Github</a></p></div><div class="flex flex-wrap gap-2 mt-4"><span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-50 text-green-700 hover:bg-green-100 transition-colors duration-200">#<!-- -->sql</span><span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-50 text-green-700 hover:bg-green-100 transition-colors duration-200">#<!-- -->analyzer</span><span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-50 text-green-700 hover:bg-green-100 transition-colors duration-200">#<!-- -->performance</span><span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-50 text-green-700 hover:bg-green-100 transition-colors duration-200">#<!-- -->log</span><span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-50 text-green-700 hover:bg-green-100 transition-colors duration-200">#<!-- -->parser</span></div></article><div class="flex a2a_kit a2a_kit_size_32 a2a_default_style gap-1 pt-8"><a class="a2a_button_facebook" alt="Share on Facebook"> </a><a class="a2a_button_twitter"> </a><a class="a2a_button_linkedin"> </a><a class="a2a_button_copy_link"> </a></div><div class="border-t border-gray-600 flex flex-col justify-center place-items-center space-y-4 p-8 pt-16 mt-16"><div class="text-center">I write about technology, career, travel and philosophy.</div><div class="flex flex-col lg:flex-row justify-center place-items-center lg:space-x-8 lg:space-y-0 space-y-8"><div class="flex flex-col"><input type="email" class="border-gray-600 rounded border focus:outline-none text-gray-600 px-4 py-2" required="" placeholder="Enter your email"/></div><button class="relative inline-flex rounded  items-center px-4 py-2 border border-gray-600 text-gray-200 bg-gray-700  hover:bg-gray-700 hover:bg-opacity-50 focus:outline-none">Subscribe</button></div></div></main><footer class="layout_container__RYcjt"><div class="border-t border-gray-600 pt-8 mt-8 mb-8"><div class="hidden lg:block"><div class="flex flex-row mb-10"><div class="flex flex-row text-gray-700 pl-0 space-x-4"><a class="text-gray-600 hover:no-underline" target="_blank" href="/sitemap.xml">Sitemap</a></div><div class="flex flex-grow justify-center text-gray-600 space-x-4 mt-1"><div>Powered by Next.js and Github Pages</div></div><div class="flex flex-row space-x-4 mt-2"><a target="_blank" title="Github" href="https://github.com/sony-mathew"><img src="/icons/github.svg" class="layout_icon__wDswo" alt="Github"/></a><a target="_blank" title="Twitter" href="https://twitter.com/sonymathew_"><img src="/icons/twitter.svg" class="layout_icon__wDswo" alt="Twitter"/></a><a target="_blank" title="Instagram" href="https://www.instagram.com/sonymathew_"><img src="/icons/instagram.svg" class="layout_icon__wDswo" alt="Instagram"/></a><a target="_blank" title="LinkedIn" href="https://www.linkedin.com/in/sonymathew"><img src="/icons/linkedin.svg" class="layout_icon__wDswo" alt="LinkedIn"/></a><a target="_blank" title="RSS" href="/rss.xml"><img src="/icons/rss.svg" class="layout_icon__wDswo" alt="RSS"/></a></div></div></div><div class="block lg:hidden"><div class="flex flex-col space-y-4"><div><a class="text-gray-600 hover:no-underline" target="_blank" href="/sitemap.xml">Sitemap</a></div><div><div>Powered by Next.js and Github Pages</div></div><div class="flex flex-row space-x-4 mt-2"><a target="_blank" title="Github" href="https://github.com/sony-mathew"><img src="/icons/github.svg" class="layout_icon__wDswo" alt="Github"/></a><a target="_blank" title="Twitter" href="https://twitter.com/sonymathew_"><img src="/icons/twitter.svg" class="layout_icon__wDswo" alt="Twitter"/></a><a target="_blank" title="Instagram" href="https://www.instagram.com/sonymathew_"><img src="/icons/instagram.svg" class="layout_icon__wDswo" alt="Instagram"/></a><a target="_blank" title="LinkedIn" href="https://www.linkedin.com/in/sonymathew"><img src="/icons/linkedin.svg" class="layout_icon__wDswo" alt="LinkedIn"/></a><a target="_blank" title="RSS" href="/rss.xml"><img src="/icons/rss.svg" class="layout_icon__wDswo" alt="RSS"/></a></div></div></div></div></footer></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"postData":{"id":"sql-log-analyzer","contentHtml":"\u003cp\u003eThis is a standalone web app that parses the SQL queries from the log and categorises them by tables and query types.\u003c/p\u003e\n\u003ch1 id=\"motivation\"\u003eMotivation\u003c/h1\u003e\n\u003cp\u003eWhile I was working in Freshworks, during feature development, I was expected to optimize each and every query that was fired as part of the feature. And many times the existing queries had to be optimized to have better response times.\u003c/p\u003e\n\u003cp\u003eIn local development, it was very tiresome to look through the Rails server logs to find out the join queries, unexpected table's queries and unwanted load queries. In order to get a holistic and organised view of the queries from the Rails server logs, I wrote this tiny standalone app using angular.\u003c/p\u003e\n\u003ch1 id=\"development\"\u003eDevelopment\u003c/h1\u003e\n\u003cp\u003eLearning Angular was one of the objectives of this hobby project. I experimented with angular for the first time while developing this (2014). I used the most primitive version of Angular for this. At that point in time, my style of learning things was to just get into it and do it. If you don't know something, search for it, learn it and do it.\u003c/p\u003e\n\u003cp\u003eThe first plan of action for this to work was to find the SQL queries from the log. The second step was to parse the queries and categorise them by tables and query types. Fortunately enough, I found a javascript library called \u003ccode\u003esimpleSqlParser\u003c/code\u003e which does this. With that library and a UI powered by Angular, I created a V1 version of this.\u003c/p\u003e\n\u003cp\u003eRecently when I was going through this, I decided to use tailwind for CSS. The first version had a bunch of handwritten CSS styles and HTML packed with some Angular controllers. If you go through the older commits from 2014-15, you will see this.\u003c/p\u003e\n\u003ch1 id=\"working\"\u003eWorking\u003c/h1\u003e\n\u003cp\u003eThis web app does not require a backend and can run in any browser. This app is used to categorise the queries by tables and by type from the log. (If you are running a Rails server, you can directly copy-paste the server logs as it will have the SQL queries.)\u003c/p\u003e\n\u003cp\u003eTo get this working, follow the following steps:\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003eYou have two options to get hands-on with this.\n\u003col\u003e\n\u003cli\u003eYou can visit the \u003ca href=\"https://sony-mathew.com/sql-log-analyzer/\" target=\"_blank\" rel=\"nofollow\"\u003elive demo page\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003eOr set this up in local environment by\n\u003col\u003e\n\u003cli\u003eCloning the repo using the following command : \u003ccode\u003egit clone git@github.com:sony-mathew/sql-log-analyzer.git\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003eand going to the cloned repo directory and open the \u003ccode\u003eindex.html\u003c/code\u003e file in your browser.\u003c/li\u003e\n\u003c/ol\u003e\n\u003c/li\u003e\n\u003c/ol\u003e\n\u003c/li\u003e\n\u003cli\u003eThe first page will have a plain text box to input the log. Copy and paste the server log in the text box. Click on Submit button.\n\u003cimg src=\"/images/posts/sql-log-analyzer/input.png\" /\u003e\u003c/li\u003e\n\u003cli\u003eVoila. Now you will be shown a page where you can select the table. Now select a table from the dropdown.\u003c/li\u003e\n\u003cli\u003eAfter selecting the table you can select the type of query related to that table.\n\u003cimg src=\"/images/posts/sql-log-analyzer/table_select.png\" /\u003e\u003c/li\u003e\n\u003cli\u003eAs soon as you select the query type, all the queries of that type related to that table you selected will be listed below.\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch1 id=\"optimizing-queries\"\u003eOptimizing Queries\u003c/h1\u003e\n\u003cp\u003eWith this, you have the list of tables and types of queries (\u003ccode\u003eJOINS\u003c/code\u003e, \u003ccode\u003eGROUP BY\u003c/code\u003e, \u003ccode\u003eWHERE\u003c/code\u003e conditions). Now the question is how do you take action on this.\u003c/p\u003e\n\u003cp\u003eI primarily worked with MySQL and Postgres. What I did with the above info was to find some suspicious queries (which had \u003ccode\u003eJOINS\u003c/code\u003e, \u003ccode\u003eWHERE\u003c/code\u003e, \u003ccode\u003eORDER BY\u003c/code\u003e or \u003ccode\u003eGROUP BY\u003c/code\u003e). Once I isolated the queries which I think was non-performant, I used \u003ccode\u003eEXPLAIN\u003c/code\u003e on those queries. The \u003ccode\u003eEXPLAIN\u003c/code\u003e statement is used to obtain a query execution plan (that is, an explanation of how MySQL or Postgres would execute a query).\u003c/p\u003e\n\u003cp\u003eFor example, consider the following query.\u003c/p\u003e\n\u003cpre class=\"language-sql\"\u003e\u003ccode class=\"language-sql code-highlight\"\u003e\u003cspan class=\"code-line line-number\" line=\"1\"\u003e\u003cspan class=\"token keyword\"\u003eSELECT\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"titles\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"tconst\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"originalTitle\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"crew\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"directors\"\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eFROM\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"titles\"\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eINNER\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eJOIN\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"crew\"\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eON\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"titles\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"tconst\"\u003c/span\u003e\u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"crew\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"tconst\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eThis is the output for this query in the console.\u003c/p\u003e\n\u003cimg src=\"/images/posts/sql-log-analyzer/sql-select-query.png\" /\u003e\n\u003cp\u003eWhen you do \u003ccode\u003eEXPLAIN\u003c/code\u003e on this query\u003c/p\u003e\n\u003cpre class=\"language-sql\"\u003e\u003ccode class=\"language-sql code-highlight\"\u003e\u003cspan class=\"code-line line-number\" line=\"1\"\u003e\u003cspan class=\"token keyword\"\u003eEXPLAIN\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eSELECT\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"titles\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"tconst\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"originalTitle\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"crew\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"directors\"\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eFROM\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"titles\"\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eINNER\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eJOIN\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"crew\"\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eON\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"titles\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"tconst\"\u003c/span\u003e\u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"crew\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"tconst\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eyou will get the following output\u003c/p\u003e\n\u003cpre class=\"language-sql\"\u003e\u003ccode class=\"language-sql code-highlight\"\u003e\u003cspan class=\"code-line line-number\" line=\"1\"\u003e\u003cspan class=\"token keyword\"\u003eHash\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eJoin\u003c/span\u003e  \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003ecost\u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\u003cspan class=\"token number\"\u003e269460.21\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token number\"\u003e.750552\u003c/span\u003e\u003cspan class=\"token number\"\u003e.93\u003c/span\u003e \u003cspan class=\"token keyword\"\u003erows\u003c/span\u003e\u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\u003cspan class=\"token number\"\u003e7328951\u003c/span\u003e width\u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\u003cspan class=\"token number\"\u003e38\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line line-number\" line=\"2\"\u003e  \u003cspan class=\"token keyword\"\u003eHash\u003c/span\u003e Cond: \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003etitles\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003etconst \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e crew\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003etconst\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line line-number\" line=\"3\"\u003e  \u003cspan class=\"token operator\"\u003e-\u003c/span\u003e\u003cspan class=\"token operator\"\u003e\u003e\u003c/span\u003e  Seq Scan \u003cspan class=\"token keyword\"\u003eon\u003c/span\u003e titles  \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003ecost\u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\u003cspan class=\"token number\"\u003e0.00\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token number\"\u003e.182196\u003c/span\u003e\u003cspan class=\"token number\"\u003e.51\u003c/span\u003e \u003cspan class=\"token keyword\"\u003erows\u003c/span\u003e\u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\u003cspan class=\"token number\"\u003e7328951\u003c/span\u003e width\u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\u003cspan class=\"token number\"\u003e30\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line line-number\" line=\"4\"\u003e  \u003cspan class=\"token operator\"\u003e-\u003c/span\u003e\u003cspan class=\"token operator\"\u003e\u003e\u003c/span\u003e  \u003cspan class=\"token keyword\"\u003eHash\u003c/span\u003e  \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003ecost\u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\u003cspan class=\"token number\"\u003e134872.76\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token number\"\u003e.134872\u003c/span\u003e\u003cspan class=\"token number\"\u003e.76\u003c/span\u003e \u003cspan class=\"token keyword\"\u003erows\u003c/span\u003e\u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\u003cspan class=\"token number\"\u003e7330676\u003c/span\u003e width\u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\u003cspan class=\"token number\"\u003e18\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line line-number\" line=\"5\"\u003e        \u003cspan class=\"token operator\"\u003e-\u003c/span\u003e\u003cspan class=\"token operator\"\u003e\u003e\u003c/span\u003e  Seq Scan \u003cspan class=\"token keyword\"\u003eon\u003c/span\u003e crew  \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003ecost\u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\u003cspan class=\"token number\"\u003e0.00\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token number\"\u003e.134872\u003c/span\u003e\u003cspan class=\"token number\"\u003e.76\u003c/span\u003e \u003cspan class=\"token keyword\"\u003erows\u003c/span\u003e\u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\u003cspan class=\"token number\"\u003e7330676\u003c/span\u003e width\u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\u003cspan class=\"token number\"\u003e18\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cimg src=\"/images/posts/sql-log-analyzer/sql-explain-query.png\" /\u003e\n\u003cp\u003eWith this query plan, you can identify sequential scans performed. If there is an \u003ccode\u003eORDER BY\u003c/code\u003e clause, you might see \u003ccode\u003eUsing temporary; Using filesort;\u003c/code\u003e in the query plan. This will give an idea on which parts of the query is making it slow. Now it's up to you to take action on the slow parts of the query.\u003c/p\u003e\n\u003cp\u003eTo fine-tune a query you have to go deeper and understand how each of the parts works. If you know how MySQL executes \u003ccode\u003eORDER BY\u003c/code\u003e, you will do certain things to optimize that when you have an \u003ccode\u003eORDER BY\u003c/code\u003e in your SQL query. This is not an everyday scenario in smaller companies. This becomes relevant when you are at scale and avoiding the bottlenecks, optimizing the system and resources for maximum performance and output.\u003c/p\u003e\n\u003cp\u003eBonus reading on \u003ca href=\"http://s.petrunia.net/blog/?p=24\" target=\"_blank\" rel=\"nofollow\"\u003eHow MySQL executes ORDER BY\u003c/a\u003e.\u003c/p\u003e\n\u003ch1 id=\"special-mention\"\u003eSpecial Mention\u003c/h1\u003e\n\u003cp\u003eI have used a third party javascript library for parsing the SQL Queries.\nThis libary is called \u003ca href=\"https://github.com/dsferruzza/simpleSqlParser\" target=\"_blank\" rel=\"nofollow\"\u003esimpleSqlParser\u003c/a\u003e and it's an awesome library, without which it would have been very difficult.\u003c/p\u003e\n\u003ch1 id=\"links\"\u003eLinks\u003c/h1\u003e\n\u003cp\u003e\u003ca href=\"https://sony-mathew.com/sql-log-analyzer/\" target=\"_blank\" rel=\"nofollow\"\u003eLive Demo\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/sony-mathew/sql-log-analyzer/\" target=\"_blank\" rel=\"nofollow\"\u003eGithub\u003c/a\u003e\u003c/p\u003e","content":"\nThis is a standalone web app that parses the SQL queries from the log and categorises them by tables and query types.\n\n# Motivation\n\nWhile I was working in Freshworks, during feature development, I was expected to optimize each and every query that was fired as part of the feature. And many times the existing queries had to be optimized to have better response times.\n\nIn local development, it was very tiresome to look through the Rails server logs to find out the join queries, unexpected table's queries and unwanted load queries. In order to get a holistic and organised view of the queries from the Rails server logs, I wrote this tiny standalone app using angular.\n\n# Development\n\nLearning Angular was one of the objectives of this hobby project. I experimented with angular for the first time while developing this (2014). I used the most primitive version of Angular for this. At that point in time, my style of learning things was to just get into it and do it. If you don't know something, search for it, learn it and do it.\n\nThe first plan of action for this to work was to find the SQL queries from the log. The second step was to parse the queries and categorise them by tables and query types. Fortunately enough, I found a javascript library called `simpleSqlParser` which does this. With that library and a UI powered by Angular, I created a V1 version of this.\n\nRecently when I was going through this, I decided to use tailwind for CSS. The first version had a bunch of handwritten CSS styles and HTML packed with some Angular controllers. If you go through the older commits from 2014-15, you will see this. \n\n# Working\n\nThis web app does not require a backend and can run in any browser. This app is used to categorise the queries by tables and by type from the log. (If you are running a Rails server, you can directly copy-paste the server logs as it will have the SQL queries.)\n\nTo get this working, follow the following steps:\n\n1. You have two options to get hands-on with this.\n    1. You can visit the [live demo page](https://sony-mathew.com/sql-log-analyzer/)\n    2. Or set this up in local environment by\n        1. Cloning the repo using the following command : `git clone git@github.com:sony-mathew/sql-log-analyzer.git`\n        2. and going to the cloned repo directory and open the `index.html` file in your browser. \n2. The first page will have a plain text box to input the log. Copy and paste the server log in the text box. Click on Submit button.\n    \u003cimg src=\"/images/posts/sql-log-analyzer/input.png\" /\u003e\n3. Voila. Now you will be shown a page where you can select the table. Now select a table from the dropdown.\n4. After selecting the table you can select the type of query related to that table. \n    \u003cimg src=\"/images/posts/sql-log-analyzer/table_select.png\" /\u003e\n5. As soon as you select the query type, all the queries of that type related to that table you selected will be listed below.\n\n# Optimizing Queries\n\nWith this, you have the list of tables and types of queries (`JOINS`, `GROUP BY`, `WHERE` conditions). Now the question is how do you take action on this. \n\nI primarily worked with MySQL and Postgres. What I did with the above info was to find some suspicious queries (which had `JOINS`, `WHERE`, `ORDER BY` or `GROUP BY`). Once I isolated the queries which I think was non-performant, I used `EXPLAIN` on those queries. The `EXPLAIN` statement is used to obtain a query execution plan (that is, an explanation of how MySQL or Postgres would execute a query).\n\nFor example, consider the following query.\n\n```sql\nSELECT \"titles\".\"tconst\", \"originalTitle\", \"crew\".\"directors\" FROM \"titles\" INNER JOIN \"crew\" ON \"titles\".\"tconst\"=\"crew\".\"tconst\";\n```\n\nThis is the output for this query in the console.\n\n\u003cimg src=\"/images/posts/sql-log-analyzer/sql-select-query.png\" /\u003e\n\nWhen you do `EXPLAIN` on this query\n\n```sql\nEXPLAIN SELECT \"titles\".\"tconst\", \"originalTitle\", \"crew\".\"directors\" FROM \"titles\" INNER JOIN \"crew\" ON \"titles\".\"tconst\"=\"crew\".\"tconst\";\n```\n\nyou will get the following output\n\n```sql\nHash Join  (cost=269460.21..750552.93 rows=7328951 width=38)\n  Hash Cond: (titles.tconst = crew.tconst)\n  -\u003e  Seq Scan on titles  (cost=0.00..182196.51 rows=7328951 width=30)\n  -\u003e  Hash  (cost=134872.76..134872.76 rows=7330676 width=18)\n        -\u003e  Seq Scan on crew  (cost=0.00..134872.76 rows=7330676 width=18)\n```\n\n\u003cimg src=\"/images/posts/sql-log-analyzer/sql-explain-query.png\" /\u003e\n\nWith this query plan, you can identify sequential scans performed. If there is an `ORDER BY` clause, you might see `Using temporary; Using filesort;` in the query plan. This will give an idea on which parts of the query is making it slow. Now it's up to you to take action on the slow parts of the query.\n\nTo fine-tune a query you have to go deeper and understand how each of the parts works. If you know how MySQL executes `ORDER BY`, you will do certain things to optimize that when you have an `ORDER BY` in your SQL query. This is not an everyday scenario in smaller companies. This becomes relevant when you are at scale and avoiding the bottlenecks, optimizing the system and resources for maximum performance and output.\n\nBonus reading on [How MySQL executes ORDER BY](http://s.petrunia.net/blog/?p=24).\n\n# Special Mention\n\nI have used a third party javascript library for parsing the SQL Queries.\nThis libary is called [simpleSqlParser](https://github.com/dsferruzza/simpleSqlParser) and it's an awesome library, without which it would have been very difficult.\n\n# Links\n\n[Live Demo](https://sony-mathew.com/sql-log-analyzer/)\n\n[Github](https://github.com/sony-mathew/sql-log-analyzer/)\n","title":"Standalone SQL Log Analyser","description":"A standalone web app that parses the SQL queries from the log and categorises them by tables and query types.","date":"2020-11-12","author":"Sony Mathew","readingTime":7,"categories":["Technology"],"tags":["sql","analyzer","performance","log","parser"],"toc":true}},"__N_SSG":true},"page":"/blog/[id]","query":{"id":"sql-log-analyzer"},"buildId":"weyHfHao6ypz-gaYJ5Xsm","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>